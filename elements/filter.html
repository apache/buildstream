

<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>filter - Extract a subset of files from another element &mdash; BuildStream 2.7.0.dev0+4.ge4dcda055 documentation</title>
      <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=03e43079" />
      <link rel="stylesheet" type="text/css" href="../_static/css/theme.css?v=e59714d7" />

  
      <script src="../_static/jquery.js?v=5d32c60e"></script>
      <script src="../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
      <script src="../_static/documentation_options.js?v=5e8ab668"></script>
      <script src="../_static/doctools.js?v=9bcbadda"></script>
      <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="manual - Manual build element" href="manual.html" />
    <link rel="prev" title="junction - Integrate subprojects" href="junction.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../index.html" class="icon icon-home">
            BuildStream
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../main_about.html">About</a></li>
<li class="toctree-l1"><a class="reference internal" href="../main_install.html">Installing from Source</a></li>
<li class="toctree-l1"><a class="reference internal" href="../main_using.html">Using</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../main_core.html">Reference</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../core_format.html">Project format</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="../core_plugins.html">Plugin specific documentation</a><ul class="current">
<li class="toctree-l3 current"><a class="reference internal" href="../core_plugins.html#elements">Elements</a><ul class="current">
<li class="toctree-l4"><a class="reference internal" href="stack.html">stack - Symbolic Element for dependency grouping</a></li>
<li class="toctree-l4"><a class="reference internal" href="import.html">import - Import sources directly</a></li>
<li class="toctree-l4"><a class="reference internal" href="compose.html">compose - Compose the output of multiple elements</a></li>
<li class="toctree-l4"><a class="reference internal" href="script.html">script - Run scripts to create output</a></li>
<li class="toctree-l4"><a class="reference internal" href="link.html">link - Link elements</a></li>
<li class="toctree-l4"><a class="reference internal" href="junction.html">junction - Integrate subprojects</a></li>
<li class="toctree-l4 current"><a class="current reference internal" href="#">filter - Extract a subset of files from another element</a></li>
<li class="toctree-l4"><a class="reference internal" href="manual.html">manual - Manual build element</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../core_plugins.html#sources">Sources</a></li>
<li class="toctree-l3"><a class="reference internal" href="../core_plugins.html#external-plugins">External plugins</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../core_framework.html">Plugin API reference</a></li>
<li class="toctree-l2"><a class="reference internal" href="../core_additional.html">Additional writings</a></li>
<li class="toctree-l2"><a class="reference internal" href="../buildstream.html">buildstream package</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../main_porting.html">Porting guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../CONTRIBUTING.html">Contributing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../main_architecture.html">Architecture</a></li>
<li class="toctree-l1"><a class="reference internal" href="../main_glossary.html">Glossary</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">BuildStream</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="../main_core.html">Reference</a></li>
          <li class="breadcrumb-item"><a href="../core_plugins.html">Plugin specific documentation</a></li>
      <li class="breadcrumb-item active">filter - Extract a subset of files from another element</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../_sources/elements/filter.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="filter-extract-a-subset-of-files-from-another-element">
<span id="module-elements.filter"></span><h1>filter - Extract a subset of files from another element<a class="headerlink" href="#filter-extract-a-subset-of-files-from-another-element" title="Link to this heading"></a></h1>
<p>Filter another element by producing an output that is a subset of
the parent element’s output. Subsets are defined by the parent element’s
<a class="reference internal" href="../format_public.html#public-split-rules"><span class="std std-ref">split rules</span></a>.</p>
<section id="overview">
<h2>Overview<a class="headerlink" href="#overview" title="Link to this heading"></a></h2>
<p>A filter element must have exactly one <em>build</em> dependency, where said
dependency is the ‘parent’ element which we would like to filter.
Runtime dependencies may also be specified, which can be useful to propagate
forward from this filter element onto its reverse dependencies.
See <a class="reference internal" href="../format_declaring.html#format-dependencies"><span class="std std-ref">Dependencies</span></a> to see how we specify dependencies.</p>
<p>When workspaces are opened, closed or reset on a filter element, or this
element is tracked, the filter element will transparently pass on the command
to its parent element (the sole build-dependency).</p>
<p class="rubric">Example</p>
<p>Consider a simple import element, <code class="docutils literal notranslate"><span class="pre">import.bst</span></code> which imports the local files
‘foo’, ‘bar’ and ‘baz’ (each stored in <code class="docutils literal notranslate"><span class="pre">files/</span></code>, relative to the project’s root):</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">import</span>

<span class="c1"># Specify sources to import</span>
<span class="nt">sources</span><span class="p">:</span>
<span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">local</span>
<span class="w">  </span><span class="nt">path</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">files</span>

<span class="c1"># Specify public domain data, visible to other elements</span>
<span class="nt">public</span><span class="p">:</span>
<span class="w">  </span><span class="nt">bst</span><span class="p">:</span>
<span class="w">    </span><span class="nt">split-rules</span><span class="p">:</span>
<span class="w">      </span><span class="nt">foo</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/foo</span>
<span class="w">      </span><span class="nt">bar</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/bar</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>We can make an element’s metadata visible to all reverse dependencies by making use
of the <code class="docutils literal notranslate"><span class="pre">public:</span></code> field. See the <a class="reference internal" href="../format_declaring.html#format-public"><span class="std std-ref">public data documentation</span></a>
for more information.</p>
</div>
<p>In this example, <code class="docutils literal notranslate"><span class="pre">import.bst</span></code> will serve as the ‘parent’ of the filter element, thus
its output will be filtered. It is important to understand that the artifact of the
above element will contain the files: ‘foo’, ‘bar’ and ‘baz’.</p>
<p>Now, to produce an element whose artifact contains the file ‘foo’, and exlusively ‘foo’,
we can define the following filter, <code class="docutils literal notranslate"><span class="pre">filter-foo.bst</span></code>:</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">filter</span>

<span class="c1"># Declare the sole build-dependency of the filter element</span>
<span class="nt">build-depends</span><span class="p">:</span>
<span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">import.bst</span>

<span class="c1"># Declare a list of domains to include in the filter&#39;s artifact</span>
<span class="nt">config</span><span class="p">:</span>
<span class="w">  </span><span class="nt">include</span><span class="p">:</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">foo</span>
</pre></div>
</div>
<p>It should be noted that an ‘empty’ <code class="docutils literal notranslate"><span class="pre">include:</span></code> list would, by default, include all
split-rules specified in the parent element, which, in this example, would be the
files ‘foo’ and ‘bar’ (the file ‘baz’ was not covered by any split rules).</p>
<p>Equally, we can use the <code class="docutils literal notranslate"><span class="pre">exclude:</span></code> statement to create the same artifact (which
only contains the file ‘foo’) by declaring the following element, <code class="docutils literal notranslate"><span class="pre">exclude-bar.bst</span></code>:</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">filter</span>

<span class="c1"># Declare the sole build-dependency of the filter element</span>
<span class="nt">build-depends</span><span class="p">:</span>
<span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">import.bst</span>

<span class="c1"># Declare a list of domains to exclude in the filter&#39;s artifact</span>
<span class="nt">config</span><span class="p">:</span>
<span class="w">  </span><span class="nt">exclude</span><span class="p">:</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bar</span>
</pre></div>
</div>
<p>In addition to the <code class="docutils literal notranslate"><span class="pre">include:</span></code> and <code class="docutils literal notranslate"><span class="pre">exclude:</span></code> fields, there exists an <code class="docutils literal notranslate"><span class="pre">include-orphans:</span></code>
(Boolean) field, which defaults to <code class="docutils literal notranslate"><span class="pre">False</span></code>. This will determine whether to include files
which are not present in the ‘split-rules’. For example, if we wanted to filter out all files
which are not included as split rules we can define the following element, <code class="docutils literal notranslate"><span class="pre">filter-misc.bst</span></code>:</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">filter</span>

<span class="c1"># Declare the sole build-dependency of the filter element</span>
<span class="nt">build-depends</span><span class="p">:</span>
<span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">import.bst</span>

<span class="c1"># Filter out all files which are not declared as split rules</span>
<span class="nt">config</span><span class="p">:</span>
<span class="w">  </span><span class="nt">exclude</span><span class="p">:</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">foo</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bar</span>
<span class="w">  </span><span class="nt">include-orphans</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">True</span>
</pre></div>
</div>
<p>The artifact of <code class="docutils literal notranslate"><span class="pre">filter-misc.bst</span></code> will only contain the file ‘baz’.</p>
<p>Below is more information regarding the the default configurations and possible options
of the filter element:</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="c1">#  Licensed under the Apache License, Version 2.0 (the &quot;License&quot;);</span>
<span class="c1">#  you may not use this file except in compliance with the License.</span>
<span class="c1">#  You may obtain a copy of the License at</span>
<span class="c1">#</span>
<span class="c1">#      http://www.apache.org/licenses/LICENSE-2.0</span>
<span class="c1">#</span>
<span class="c1">#  Unless required by applicable law or agreed to in writing, software</span>
<span class="c1">#  distributed under the License is distributed on an &quot;AS IS&quot; BASIS,</span>
<span class="c1">#  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.</span>
<span class="c1">#  See the License for the specific language governing permissions and</span>
<span class="c1">#  limitations under the License.</span>

<span class="c1"># Filter element configuration</span>
<span class="nt">config</span><span class="p">:</span>

<span class="w">  </span><span class="c1"># A list of domains to include in each artifact, as</span>
<span class="w">  </span><span class="c1"># they were defined as public data in the parent</span>
<span class="w">  </span><span class="c1"># element&#39;s &#39;split-rules&#39;.</span>
<span class="w">  </span><span class="c1">#</span>
<span class="w">  </span><span class="c1"># If a domain is specified that does not exist, the</span>
<span class="w">  </span><span class="c1"># filter element will fail to build.</span>
<span class="w">  </span><span class="c1">#</span>
<span class="w">  </span><span class="c1"># The default empty list indicates that all domains</span>
<span class="w">  </span><span class="c1"># of the parent&#39;s artifact should be included.</span>
<span class="w">  </span><span class="c1">#</span>
<span class="w">  </span><span class="nt">include</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[]</span>

<span class="w">  </span><span class="c1"># A list of domains to exclude from each artifact, as</span>
<span class="w">  </span><span class="c1"># they were defined in the parent element&#39;s &#39;split-rules&#39;.</span>
<span class="w">  </span><span class="c1">#</span>
<span class="w">  </span><span class="c1"># In the case that a file is spoken for by a domain</span>
<span class="w">  </span><span class="c1"># in the &#39;include&#39; list and another in the &#39;exclude&#39;</span>
<span class="w">  </span><span class="c1"># list, then the file will be excluded.</span>
<span class="w">  </span><span class="nt">exclude</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[]</span>

<span class="w">  </span><span class="c1"># Whether to include orphan files which are not</span>
<span class="w">  </span><span class="c1"># included by any of the &#39;split-rules&#39; present in</span>
<span class="w">  </span><span class="c1"># the parent element.</span>
<span class="w">  </span><span class="c1">#</span>
<span class="w">  </span><span class="nt">include-orphans</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">False</span>

<span class="w">  </span><span class="c1"># Whether to pass the &#39;integration-commands&#39; of the</span>
<span class="w">  </span><span class="c1"># parent element through the filter.</span>
<span class="w">  </span><span class="c1">#</span>
<span class="w">  </span><span class="nt">pass-integration</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">False</span>
</pre></div>
</div>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="junction.html" class="btn btn-neutral float-left" title="junction - Integrate subprojects" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="manual.html" class="btn btn-neutral float-right" title="manual - Manual build element" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2017-2022, The Apache Software Foundation.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>